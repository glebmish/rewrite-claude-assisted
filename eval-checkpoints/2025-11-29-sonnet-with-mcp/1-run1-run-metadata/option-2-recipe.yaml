---
type: specs.openrewrite.org/v1beta/recipe
name: com.weather.api.PRRecipe3Option2
displayName: Upgrade to Java 17 - Enhanced Hybrid Approach
description: |
  Hybrid approach combining semantic recipes for Java/Gradle changes with text-based
  recipes for Dockerfile and complex code transformations. Maximizes automation coverage
  while avoiding the over-application risks of broad migration recipes.

recipeList:
  # 1. Gradle Java Compatibility Updates
  - org.openrewrite.gradle.UpdateJavaCompatibility:
      version: 17
      compatibilityType: source
      declarationStyle: String
  - org.openrewrite.gradle.UpdateJavaCompatibility:
      version: 17
      compatibilityType: target
      declarationStyle: String

  # 2. Gradle Wrapper Upgrade
  - org.openrewrite.gradle.UpdateGradleWrapper:
      version: 7.6

  # 3. Dockerfile Base Image Updates (text-based - no semantic recipe exists)
  - org.openrewrite.text.FindAndReplace:
      find: "FROM openjdk:11-jdk-slim"
      replace: "FROM eclipse-temurin:17-jdk-alpine"
      regex: false
      caseSensitive: true
      filePattern: "**/Dockerfile"
  - org.openrewrite.text.FindAndReplace:
      find: "FROM openjdk:11-jre-slim"
      replace: "FROM eclipse-temurin:17-jre-alpine"
      regex: false
      caseSensitive: true
      filePattern: "**/Dockerfile"

  # 4. Delete Obsolete Authentication Files
  - org.openrewrite.DeleteSourceFiles:
      filePattern: "weather-api/src/main/java/com/weather/api/auth/JwtAuthFilter.java"
  - org.openrewrite.DeleteSourceFiles:
      filePattern: "weather-api/src/main/java/com/weather/api/auth/JwtAuthenticator.java"
  - org.openrewrite.DeleteSourceFiles:
      filePattern: "weather-api/src/main/java/com/weather/api/auth/ApiKeyAuthFilter.java"
  - org.openrewrite.DeleteSourceFiles:
      filePattern: "weather-api/src/test/java/com/weather/api/auth/JwtAuthenticatorTest.java"

  # 5. Remove Unused Imports (cleanup after deletions)
  - org.openrewrite.java.RemoveUnusedImports

  # 6. Format Code
  - org.openrewrite.java.format.AutoFormat
